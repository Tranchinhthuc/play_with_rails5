<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Test-Right-Now</title>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css" />
    <%= csrf_meta_tags %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body class="skin-blue sidebar-mini fixed <%= params[:controller].parameterize %> <%= action_name %>" style="font-size: 15px">
    <div id="fb-root"></div>
    <script type="text/javascript">
      $(document).ready(function() {
        var page_like_callback = function(url, html_element) {
          console.log("page_like_callback");
          $.post( "/users/like_page", function( data ) {
            location.reload();
          });
        }
        var page_unlike_callback = function(url, html_element) {
          console.log("page_unlike_callback");
          $.post( "users/unlike_page", function( data ) {
            location.reload();
          });
        }
        $.ajaxSetup({ cache: true });
        $.getScript('//connect.facebook.net/en_US/sdk.js', function(){
          FB.init({
            appId: '1584038561884421',
            version: 'v2.7' // or v2.1, v2.2, v2.3, ...
          });
          $('#loginbutton,#feedbutton').removeAttr('disabled');
          FB.Event.subscribe('edge.create', page_like_callback);
          FB.Event.subscribe('edge.remove', page_unlike_callback);
        });
      });
    </script>
    <script>
      // window.fbAsyncInit = function() {
      //   FB.init({
      //     appId      : '1584038561884421',
      //     xfbml      : true,
      //     version    : 'v2.8'
      //   });
      //   FB.Event.subscribe('edge.create', page_like_or_unlike_callback);
      // };
      // (function(d, s, id) {
      //   var js, fjs = d.getElementsByTagName(s)[0];
      //   if (d.getElementById(id)) return;
      //   js = d.createElement(s); js.id = id;
      //   js.src = "//connect.facebook.net/en_GB/sdk.js";
      //   fjs.parentNode.insertBefore(js, fjs);
      // }(document, 'script', 'facebook-jssdk'));
    </script>

    <div class="wrapper">
      <div>
        <%= render "shared/header" %>
        <%= render 'shared/left_side_bar' %>
      </div>
      <div class="content-wrapper">
        <div class="container">
          <% if user_signed_in? %>
            <div class="row">
              <div class="col-md-10">
                <!-- <div class="add"> -->
                  <% if controller_name.in?(SysConst::TABLE_NAME + SysConst::LESSON_TYPES.map(&:to_s)) && !action_name.in?(["new", "create"]) %>
                    <% name = controller_name.include?("lesson") ? controller_name.singularize.gsub("_lesson", "").pluralize : controller_name %>
                    <div class="page-tabs">
                      <ul class="nav nav-pills">
                          <li class="<%= (controller_name.include?('lessons') && action_name == 'index') ? 'active' : '' %>">
                            <%= link_to "Lessons", Rails.application.routes.url_helpers.send("#{name.singularize}_lessons_path") %>
                          </li>
                          <li class="<%= (!controller_name.include?('lessons') && action_name == 'index') ? 'active' : '' %>">
                            <%= link_to "Câu hỏi đã chia sẻ", Rails.application.routes.url_helpers.send("#{name}_path") %>
                          </li>
                      </ul>
                    </div>
                    <%= link_to "Chia sẻ câu hỏi của bạn", [:new, singulize_model_name(name).to_sym], class: "btn btn-primary pull-right contribute-button" %>
                  <% end %>
                <!-- </div> -->
                <% flash.each do |message_type, message| %>
                  <div class="alert alert-<%= message_type %> col-md-10-offset-2"><%= message %></div>
                <% end %>
                <%= yield %>
              </div>
            </div>
          <% else %>
            <section class="content">
              <% if notice %>
                <div class="alert alert-success alert-dismissable">
                  <i class="fa fa-check"></i>
                  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                  <b><%= notice %></b>
                </div>
              <% end %>

              <% if alert %>
                <div class="alert alert-danger alert-dismissable">
                  <i class="fa fa-ban"></i>
                  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                  <b><%= alert %></b>
                </div>
              <% end %>
              <%= yield %>
            </section>
          <% end %>
        </div>
        <div class="container">
          <div class="row footer">
            <div class="col-md-12">
              <%= render "shared/footer" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
    $( document ).ready(function() {
      var page_like_or_unlike_callback = function(url, html_element) {
        console.log("page_like_or_unlike_callback");
        console.log(url);
        console.log(html_element);
      }
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '1584038561884421',
          xfbml      : true,
          version    : 'v2.8'
        });
        // FB.AppEvents.logPageView();
        FB.Event.subscribe('edge.create', page_like_or_unlike_callback);
      };

      // In your onload handler
    });
  </script>
</html>
